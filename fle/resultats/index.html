<!doctype html>
<head>
  <title>R&eacute;sultats des rendez-vous</title>
  <style type="text/css">
    html, body {
      height: 100%;
    }

    html {
      display: table;
      margin: auto;
    }

    body {
      display: table-cell;
      vertical-align: middle;
    }
  </style>
</head>

<body>
  <h2>R&eacute;sultats des rendez-vous</h2>

  <p>T&eacute;l&eacute;chargez les r&eacute;sultats en format CSV <a href="../rendezvous.csv">ici</a>.</p>
  <div id="handsontable-container"></div>

  <script src="https://cdn.jsdelivr.net/handsontable/0.28.4/handsontable.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5"></script>
  <script>
/* global FileReader, Papa, Handsontable */

var handsontableContainer = document.getElementById('handsontable-container')

window.onload = function () {
  var request = new XMLHttpRequest();
  request.open('GET', '../rendezvous.csv', true);
  request.responseType = 'blob';
  request.onload = function() {
    var reader = new FileReader();
    reader.readAsText(request.response);
    reader.onload =  function(e) {
      var csv = 'Pr&eacute;nom,nom,t&eacute;l&eacute;phone,email,horaire\n' + e.target.result
      var data = Papa.parse(csv, {
        header: true,
        skipEmptyLines: true
      })

      // reset container
      handsontableContainer.innerHTML = ''
      handsontableContainer.className = ''

      Handsontable(handsontableContainer, {
        data: data.data,
        rowHeaders: true,
        colHeaders: data.meta.fields,
        columnSorting: true
      })
    }
  }
  request.send();
}
  </script>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/handsontable/0.28.4/handsontable.full.min.css">
</body>